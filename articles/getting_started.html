<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tidysdm">
<title>Getting Started with {tidysdm} • tidysdm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with {tidysdm}">
<meta property="og:description" content="tidysdm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidysdm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting_started.html">Getting Started with {tidysdm}</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting Started with {tidysdm}</h1>
            
      
      
      <div class="d-none name"><code>getting_started.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rdinnager.github.io/tidysdm/">tidysdm</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: parsnip</span></span>
<span><span class="co">#&gt; Loading required package: recipes</span></span>
<span><span class="co">#&gt; Loading required package: dplyr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'recipes'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     step</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">112233</span><span class="op">)</span></span></code></pre></div>
<p><code>tidysdm</code> is an offshoot of the <code>ENMTools</code>
package, and will eventually take over that package’s modelling
functions. <code>tidysdm</code> is a package to make it easy to fit
Species Distribution Models in a <code>tidymodels</code> framework. We
will use data from the <code>ENMTools</code> package to demonstrate how
<code>tidysdm</code> works.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ENMTools</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: dismo</span></span>
<span><span class="co">#&gt; Loading required package: raster</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'raster'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     select</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">tidyr</span>::<span style="color: #00BB00;">extract()</span> masks <span style="color: #0000BB;">raster</span>::extract()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span>  masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">stringr</span>::<span style="color: #00BB00;">fixed()</span> masks <span style="color: #0000BB;">recipes</span>::fixed()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>     masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">raster</span>::<span style="color: #00BB00;">select()</span> masks <span style="color: #0000BB;">dplyr</span>::select()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching packages</span> ────────────────────────────────────── tidymodels 1.1.1 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">broom       </span> 1.0.5     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tune        </span> 1.1.2</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dials       </span> 1.2.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">workflows   </span> 1.1.3</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">infer       </span> 1.0.5     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">workflowsets</span> 1.0.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">modeldata   </span> 1.2.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">yardstick   </span> 1.2.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">rsample     </span> 1.2.0     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ───────────────────────────────────────── tidymodels_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">scales</span>::<span style="color: #00BB00;">discard()</span>  masks <span style="color: #0000BB;">purrr</span>::discard()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">tidyr</span>::<span style="color: #00BB00;">extract()</span>   masks <span style="color: #0000BB;">raster</span>::extract()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span>    masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">stringr</span>::<span style="color: #00BB00;">fixed()</span>   masks <span style="color: #0000BB;">recipes</span>::fixed()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>       masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">raster</span>::<span style="color: #00BB00;">select()</span>   masks <span style="color: #0000BB;">dplyr</span>::select()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">yardstick</span>::<span style="color: #00BB00;">spec()</span>  masks <span style="color: #0000BB;">readr</span>::spec()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">recipes</span>::<span style="color: #00BB00;">step()</span>    masks <span style="color: #0000BB;">stats</span>::step()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dials</span>::<span style="color: #00BB00;">threshold()</span> masks <span style="color: #0000BB;">dismo</span>::threshold()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">raster</span>::<span style="color: #00BB00;">update()</span>   masks <span style="color: #0000BB;">recipes</span>::update(), <span style="color: #0000BB;">stats</span>::update()</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">•</span> Learn how to get started at <span style="color: #00BB00;">https://www.tidymodels.org/start/</span></span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/spatialsample" class="external-link">spatialsample</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"iberolacerta.clade"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in data("iberolacerta.clade"): data set 'iberolacerta.clade' not found</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"euro.worldclim"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in data("euro.worldclim"): data set 'euro.worldclim' not found</span></span>
<span><span class="va">monticola</span> <span class="op">&lt;-</span> <span class="va">iberolacerta.clade</span><span class="op">$</span><span class="va">species</span><span class="op">$</span><span class="va">monticola</span></span></code></pre></div>
<p>We start by generating a {tidymodels} compatable <code>sf</code>
object for the species we want to model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdm_data.html">sdm_data</a></span><span class="op">(</span><span class="va">monticola</span><span class="op">$</span><span class="va">presence.points</span>,</span>
<span>                bg <span class="op">=</span> <span class="va">monticola</span><span class="op">$</span><span class="va">range</span>,</span>
<span>                n <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>                coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>,</span>
<span>                           <span class="st">"Latitude"</span><span class="op">)</span>,</span>
<span>                crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span></span>
<span><span class="va">dat</span></span>
<span><span class="co">#&gt; Simple feature collection with 5260 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -9.328902 ymin: 39.8349 xmax: 0.6643092 ymax: 43.83336</span></span>
<span><span class="co">#&gt; Geodetic CRS:  BOUNDCRS[</span></span>
<span><span class="co">#&gt;     SOURCECRS[</span></span>
<span><span class="co">#&gt;         GEOGCRS["unknown",</span></span>
<span><span class="co">#&gt;             DATUM["World Geodetic System 1984",</span></span>
<span><span class="co">#&gt;                 ELLIPSOID["WGS 84",6378137,298.257223563,</span></span>
<span><span class="co">#&gt;                     LENGTHUNIT["metre",1]],</span></span>
<span><span class="co">#&gt;                 ID["EPSG",6326]],</span></span>
<span><span class="co">#&gt;             PRIMEM["Greenwich",0,</span></span>
<span><span class="co">#&gt;                 ANGLEUNIT["degree",0.0174532925199433],</span></span>
<span><span class="co">#&gt;                 ID["EPSG",8901]],</span></span>
<span><span class="co">#&gt;             CS[ellipsoidal,2],</span></span>
<span><span class="co">#&gt;                 AXIS["longitude",east,</span></span>
<span><span class="co">#&gt;                     ORDER[1],</span></span>
<span><span class="co">#&gt;                     ANGLEUNIT["degree",0.0174532925199433,</span></span>
<span><span class="co">#&gt;                         ID["EPSG",9122]]],</span></span>
<span><span class="co">#&gt;                 AXIS["latitude",north,</span></span>
<span><span class="co">#&gt;                     ORDER[2],</span></span>
<span><span class="co">#&gt;                     ANGLEUNIT["degree",0.0174532925199433,</span></span>
<span><span class="co">#&gt;                         ID["EPSG",9122]]]]],</span></span>
<span><span class="co">#&gt;     TARGETCRS[</span></span>
<span><span class="co">#&gt;         GEOGCRS["WGS 84",</span></span>
<span><span class="co">#&gt;             DATUM["World Geodetic System 1984",</span></span>
<span><span class="co">#&gt;                 ELLIPSOID["WGS 84",6378137,298.257223563,</span></span>
<span><span class="co">#&gt;                     LENGTHUNIT["metre",1]]],</span></span>
<span><span class="co">#&gt;             PRIMEM["Greenwich",0,</span></span>
<span><span class="co">#&gt;                 ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co">#&gt;             CS[ellipsoidal,2],</span></span>
<span><span class="co">#&gt;                 AXIS["geodetic latitude (Lat)",north,</span></span>
<span><span class="co">#&gt;                     ORDER[1],</span></span>
<span><span class="co">#&gt;                     ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co">#&gt;                 AXIS["geodetic longitude (Lon)",east,</span></span>
<span><span class="co">#&gt;                     ORDER[2],</span></span>
<span><span class="co">#&gt;                     ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co">#&gt;             ID["EPSG",4326]]],</span></span>
<span><span class="co">#&gt;     ABRIDGEDTRANSFORMATION["Transformation from unknown to WGS84",</span></span>
<span><span class="co">#&gt;         METHOD["Geocentric translations (geog2D domain)",</span></span>
<span><span class="co">#&gt;             ID["EPSG",9603]],</span></span>
<span><span class="co">#&gt;         PARAMETER["X-axis translation",0,</span></span>
<span><span class="co">#&gt;             ID["EPSG",8605]],</span></span>
<span><span class="co">#&gt;         PARAMETER["Y-axis translation",0,</span></span>
<span><span class="co">#&gt;             ID["EPSG",8606]],</span></span>
<span><span class="co">#&gt;         PARAMETER["Z-axis translation",0,</span></span>
<span><span class="co">#&gt;             ID["EPSG",8607]]]]</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    present pnt_origin                       pnts</span></span>
<span><span class="co">#&gt; 1  present       data POINT (-5.171215 43.06957)</span></span>
<span><span class="co">#&gt; 2  present       data POINT (-6.036635 43.02531)</span></span>
<span><span class="co">#&gt; 3  present       data POINT (-7.679727 40.38852)</span></span>
<span><span class="co">#&gt; 4  present       data POINT (-7.790437 40.30959)</span></span>
<span><span class="co">#&gt; 5  present       data  POINT (-7.47334 43.78935)</span></span>
<span><span class="co">#&gt; 6  present       data  POINT (-6.575039 42.9107)</span></span>
<span><span class="co">#&gt; 7  present       data POINT (-5.132756 43.49572)</span></span>
<span><span class="co">#&gt; 8  present       data POINT (-7.787378 40.39362)</span></span>
<span><span class="co">#&gt; 9  present       data  POINT (-4.941888 43.3531)</span></span>
<span><span class="co">#&gt; 10 present       data  POINT (-7.621731 40.3417)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>       <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">present</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">present</span><span class="op">)</span>, </span>
<span>     pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/bg_convert-1.png" width="700"></p>
<p>Now we can use the <a href="https://github.com/tidymodels/spatialsample" class="external-link">spatialsample</a> package to create
spatial cross validation folds! We will first create a regular cross
validation fold object for comparison. Note that this can take awhile
because a spatial distance is calculated between all points!</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## regular CV</span></span>
<span><span class="va">cv_folds</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">dat</span>, <span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## spatial CV</span></span>
<span><span class="va">cv_folds_spat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://spatialsample.tidymodels.org/reference/spatial_block_cv.html" class="external-link">spatial_block_cv</a></span><span class="op">(</span><span class="va">dat</span>, method <span class="op">=</span> <span class="st">"snake"</span>,</span>
<span>                             n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                             v <span class="op">=</span> <span class="fl">9</span>,</span>
<span>                             buffer <span class="op">=</span> <span class="fl">50000</span><span class="op">)</span></span>
<span><span class="va">cv_folds_spat</span></span>
<span><span class="co">#&gt; #  9-fold spatial block cross-validation </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 2</span></span></span>
<span><span class="co">#&gt;   splits              id   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;split [3979/459]&gt;</span>  Fold1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">&lt;split [4031/437]&gt;</span>  Fold2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #949494;">&lt;split [3873/807]&gt;</span>  Fold3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="color: #949494;">&lt;split [4213/517]&gt;</span>  Fold4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> <span style="color: #949494;">&lt;split [4443/333]&gt;</span>  Fold5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="color: #949494;">&lt;split [4366/129]&gt;</span>  Fold6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> <span style="color: #949494;">&lt;split [3534/638]&gt;</span>  Fold7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> <span style="color: #949494;">&lt;split [3307/875]&gt;</span>  Fold8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> <span style="color: #949494;">&lt;split [3215/1064]&gt;</span> Fold9</span></span>
<span></span>
<span></span>
<span><span class="co">## look at the spatial folds</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">cv_folds_spat</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/spatial_block_cv-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">cv_folds_spat</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/spatial_block_cv-2.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">cv_folds_spat</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/spatial_block_cv-3.png" width="700"></p>
<p>A faster spatial cross validation specifically designed for
presence-only data is included in <a href="https://rdinnager.github.io/tidysdm/">tidysdm</a>. It is faster
because it first divides the space up into a grid, and then uses the
grid cells in the cross validation instead of individual points. All
point in each grid cell get ‘dragged along’ with the cell as it gets
shuffled into the analysis or assessment set. This way the function does
not have to calculate pairwise distance for all points, just for the
grid cells. It also reduces the chances of getting analysis sets with
only presences or only absences. Let’s try it now.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## presence only (po) spatial CV</span></span>
<span><span class="va">cv_folds_spat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/po_spatial_buffer_vfold_cv.html">po_spatial_buffer_vfold_cv</a></span><span class="op">(</span><span class="va">dat</span>, presence <span class="op">=</span> <span class="st">"present"</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">24</span>, <span class="fl">16</span><span class="op">)</span>,</span>
<span>                                             v <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## look at the spatial folds</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">cv_folds_spat</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/spatial_block_cv2-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">cv_folds_spat</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/spatial_block_cv2-2.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">cv_folds_spat</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/spatial_block_cv2-3.png" width="700"></p>
<p>Let’s create a recipe to apply some common data processing steps to
prepare for SDM fitting. We start with <code>step_add_env_vars()</code>,
which is a <a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a> function. The rest are standard
steps from the <a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a> package.
<code><a href="https://recipes.tidymodels.org/reference/step_impute_median.html" class="external-link">step_impute_median()</a></code> imputes missing values (since we will
be doing a random forest model which cannot handle missing values).
<code><a href="https://recipes.tidymodels.org/reference/step_YeoJohnson.html" class="external-link">step_YeoJohnson()</a></code> does a Yeo-Johnson transformation on the
predictors, which makes them more symmetric and
‘<em>Gaussian</em>-like’. It also saves the parameters used in the
transformation which will be automatically applied to any test data used
for prediction later. Finally <code><a href="https://recipes.tidymodels.org/reference/step_normalize.html" class="external-link">step_normalize()</a></code> transforms
predictors to have a mean of zero and a standard deviation of 1, so that
they are all on the same scale. It also saves the means and sds to be
applied to test data. To see the result of the step we run
<code><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep()</a></code> and <code>bake(new_data = NULL)</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdm_recipe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_add_env_vars</span><span class="op">(</span>env <span class="op">=</span> <span class="va">euro.worldclim</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_impute_median.html" class="external-link">step_impute_median</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_YeoJohnson.html" class="external-link">step_YeoJohnson</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html" class="external-link">step_normalize</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">sdm_recipe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5,260 × 22</span></span></span>
<span><span class="co">#&gt;    present                 pnts pnt_origin   bio1    bio2   bio3     bio4</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> present (-5.171215 43.06957) data       -<span style="color: #BB0000;">1.46</span>   0.159   0.752 -<span style="color: #BB0000;">0.330</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> present (-6.036635 43.02531) data       -<span style="color: #BB0000;">1.52</span>   0.159   0.752 -<span style="color: #BB0000;">0.334</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> present (-7.679727 40.38852) data        1.05  -<span style="color: #BB0000;">0.339</span>  -<span style="color: #BB0000;">0.214</span> -<span style="color: #BB0000;">0.040</span><span style="color: #BB0000; text-decoration: underline;">5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> present (-7.790437 40.30959) data        0.629 -<span style="color: #BB0000;">0.769</span>  -<span style="color: #BB0000;">1.18</span>  -<span style="color: #BB0000;">0.023</span><span style="color: #BB0000; text-decoration: underline;">5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> present  (-7.47334 43.78935) data        1.21  -<span style="color: #BB0000;">1.45</span>    1.72  -<span style="color: #BB0000;">1.61</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> present  (-6.575039 42.9107) data       -<span style="color: #BB0000;">1.26</span>   0.070<span style="text-decoration: underline;">8</span>  0.752 -<span style="color: #BB0000;">0.245</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> present (-5.132756 43.49572) data        0.836 -<span style="color: #BB0000;">1.35</span>    1.24  -<span style="color: #BB0000;">1.33</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> present (-7.787378 40.39362) data        1.05  -<span style="color: #BB0000;">0.339</span>  -<span style="color: #BB0000;">0.214</span> -<span style="color: #BB0000;">0.040</span><span style="color: #BB0000; text-decoration: underline;">5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> present  (-4.941888 43.3531) data        0.578 -<span style="color: #BB0000;">1.35</span>    0.752 -<span style="color: #BB0000;">1.26</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> present  (-7.621731 40.3417) data       -<span style="color: #BB0000;">0.643</span> -<span style="color: #BB0000;">1.45</span>   -<span style="color: #BB0000;">2.61</span>   0.006<span style="text-decoration: underline;">22</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5,250 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more variables: bio5 &lt;dbl&gt;, bio6 &lt;dbl&gt;, bio7 &lt;dbl&gt;, bio8 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   bio9 &lt;dbl&gt;, bio10 &lt;dbl&gt;, bio11 &lt;dbl&gt;, bio12 &lt;dbl&gt;, bio13 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   bio14 &lt;dbl&gt;, bio15 &lt;dbl&gt;, bio16 &lt;dbl&gt;, bio17 &lt;dbl&gt;, bio18 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   bio19 &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Now we can setup a random forest model with <a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a>
and combine it with our recipe using a workflow from the
<a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a> package..</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/rand_forest.html" class="external-link">rand_forest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"ranger"</span>, importance <span class="op">=</span> <span class="st">"impurity"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">sdm_recipe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">mod</span>,</span>
<span>            formula <span class="op">=</span> <span class="va">present</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf</span></span>
<span><span class="co">#&gt; ══ Workflow ════════════════════════════════════════════════════════════════════</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Model:</span> rand_forest()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; 4 Recipe Steps</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • step_add_env_vars()</span></span>
<span><span class="co">#&gt; • step_impute_median()</span></span>
<span><span class="co">#&gt; • step_YeoJohnson()</span></span>
<span><span class="co">#&gt; • step_normalize()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Random Forest Model Specification (classification)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Engine-Specific Arguments:</span></span>
<span><span class="co">#&gt;   importance = impurity</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computational engine: ranger</span></span></code></pre></div>
<p>Now we fit the model! We will start with the regular cross validation
folds, and use <code>fit_resamples()</code> to generate metrics based on
the fits to each of the validation sets in our folds. Then
<code>collect_metrics()</code> will calculate the means across folds for
us.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_1</span> <span class="op">&lt;-</span> <span class="va">wf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">fit_resamples</span><span class="op">(</span><span class="va">cv_folds</span>, </span>
<span>                control <span class="op">=</span> <span class="fu">control_resamples</span><span class="op">(</span>extract <span class="op">=</span> <span class="va">extract_fit_engine</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator  mean     n std_err .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary     0.948     9 0.002<span style="text-decoration: underline;">14</span> Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary     0.823     9 0.016<span style="text-decoration: underline;">0</span>  Preprocessor1_Model1</span></span></code></pre></div>
<p>Okay, so our ROC AUC value is pretty good at around 0.82. Now we do
the same for the spatial cross validation folds.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_2</span> <span class="op">&lt;-</span> <span class="va">wf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">fit_resamples</span><span class="op">(</span><span class="va">cv_folds_spat</span>,</span>
<span>                control <span class="op">=</span> <span class="fu">control_resamples</span><span class="op">(</span>extract <span class="op">=</span> <span class="va">extract_fit_engine</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator  mean     n std_err .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary     0.950     9 0.006<span style="text-decoration: underline;">48</span> Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary     0.725     9 0.025<span style="text-decoration: underline;">9</span>  Preprocessor1_Model1</span></span></code></pre></div>
<p>Using spatially independent cross validation folds has shown us our
model does much more poorly if we ask it to generalise to spatial areas
not in the training set. Now ROC AUC is only ~ 0.72 – considerably
worse. Looking at the individual folds, there is substantial variation
in the quality of models.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_2</span><span class="op">$</span><span class="va">.metrics</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator .estimate .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary         0.950 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary         0.753 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator .estimate .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary         0.976 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary         0.707 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator .estimate .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary         0.949 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary         0.826 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator .estimate .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary         0.980 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary         0.650 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator .estimate .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary         0.959 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary         0.590 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator .estimate .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary         0.947 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary         0.809 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[7]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator .estimate .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary         0.920 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary         0.722 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[8]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator .estimate .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary         0.929 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary         0.786 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[9]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator .estimate .config             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary         0.942 Preprocessor1_Model1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> roc_auc  binary         0.679 Preprocessor1_Model1</span></span></code></pre></div>
<p>In the eighth fold the model looks to have done a reasonable job.
Which one was that?</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">cv_folds_spat</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/plot_last_fold-1.png" width="700"></p>
<p>Let’s have a look at the importance values determined by the random
forest for our variables.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/koalaverse/vip/" class="external-link">vip</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'vip'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     vi</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'patchwork'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:raster':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     area</span></span>
<span></span>
<span><span class="va">fit_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">.extracts</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">.extracts</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">vip</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/importance-1.png" width="700"></p>
<p>The ordering is reasonably consistent between different folds. Now,
the spatial folds:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">.extracts</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">.extracts</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">vip</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/importance2-1.png" width="700"></p>
<p>There seems to be quite a bit more variation in what variables are
important between different spatial folds. Which is interesting.</p>
<p>We can try and improve the performance of the model on spatially
independent data by using the spatial cross validation folds to tune the
hyperparameters of the model. We can use the <a href="https://tune.tidymodels.org/" class="external-link">tune</a> package
for this. Using <code>tune_bayes()</code> we can use Bayesian
optimization to find an optimal set. What hyperparameters should we
tune. For random forest we only have three, <code>mtry</code>,
<code>trees</code>, and <code>min_n</code>. Let’s try tuning all three.
First we make a new model object where we designate these parameters for
tuning, then wrap it into a new workflow.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_tune</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/rand_forest.html" class="external-link">rand_forest</a></span><span class="op">(</span>mtry <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        trees <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        min_n <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"ranger"</span>, importance <span class="op">=</span> <span class="st">"impurity"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf_tune</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">sdm_recipe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">mod_tune</span>,</span>
<span>            formula <span class="op">=</span> <span class="va">present</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf_tune</span></span>
<span><span class="co">#&gt; ══ Workflow ════════════════════════════════════════════════════════════════════</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Model:</span> rand_forest()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; 4 Recipe Steps</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • step_add_env_vars()</span></span>
<span><span class="co">#&gt; • step_impute_median()</span></span>
<span><span class="co">#&gt; • step_YeoJohnson()</span></span>
<span><span class="co">#&gt; • step_normalize()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Random Forest Model Specification (classification)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Arguments:</span></span>
<span><span class="co">#&gt;   mtry = tune()</span></span>
<span><span class="co">#&gt;   trees = tune()</span></span>
<span><span class="co">#&gt;   min_n = tune()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Engine-Specific Arguments:</span></span>
<span><span class="co">#&gt;   importance = impurity</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computational engine: ranger</span></span></code></pre></div>
<p>Tuning is now as simple as calling <code>tune_bayes()</code>. First
we set up an initial set of tuning models using a tuning grid (regularly
spaced values of the hyper-parameters). By the way, this will take
awhile. If you want to do this on your computer I would recommend
setting up a parallel backend for tuning (see <a href="https://tune.tidymodels.org/articles/extras/optimizations.html" class="external-link uri">https://tune.tidymodels.org/articles/extras/optimizations.html</a>).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tune_init</span> <span class="op">&lt;-</span> <span class="va">wf_tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tune_grid</span><span class="op">(</span><span class="va">cv_folds_spat</span>,</span>
<span>            grid <span class="op">=</span> <span class="fl">27</span>,</span>
<span>            control <span class="op">=</span> <span class="fu">control_grid</span><span class="op">(</span>verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">i</span> <span style="color: #000000;">Creating pre-processing data to finalize unknown parameter: mtry</span></span></span></code></pre></div>
<p>Now this serves as initial values for <code>tune_bayes()</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_parameter_set_dials</a></span><span class="op">(</span><span class="va">mod_tune</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">finalize</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tuned</span> <span class="op">&lt;-</span> <span class="va">wf_tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tune_bayes</span><span class="op">(</span><span class="va">cv_folds_spat</span>,</span>
<span>             initial <span class="op">=</span> <span class="va">tune_init</span>,</span>
<span>             iter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>             param_info <span class="op">=</span> <span class="va">final_params</span>,</span>
<span>             control <span class="op">=</span> <span class="fu">control_bayes</span><span class="op">(</span>verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                     no_improve <span class="op">=</span> <span class="fl">50L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; → <span style="color: #BBBB00; font-weight: bold;">A</span> | <span style="color: #BBBB00;">warning</span>: X should be in range (0, 1)</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x1</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x2</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x3</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x4</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x5</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x6</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x7</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x8</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x9</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x10</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x11</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x12</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x13</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x14</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x15</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x16</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x17</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x18</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x19</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x20</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x21</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x22</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x23</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x24</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x25</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x26</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x27</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x28</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x29</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x30</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x31</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x32</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x33</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x34</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x35</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x36</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x37</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x38</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x39</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x40</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x41</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x42</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x43</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x44</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x45</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x46</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x47</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x48</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x49</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x50</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x51</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x52</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x53</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x54</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x55</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x56</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x57</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x58</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x59</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x60</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x61</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x62</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x63</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x64</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x65</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x66</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x67</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x68</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x69</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x70</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x71</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x72</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x73</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x74</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x75</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x76</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x77</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x78</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x79</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x80</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x81</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x82</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x83</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x84</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x85</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x86</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x87</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x88</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x89</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x90</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x91</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x92</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x93</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x94</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x95</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x96</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x97</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x98</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x99</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x100</span></span>
<span><span class="co">#&gt; There were issues with some computations   <span style="color: #BBBB00; font-weight: bold;">A</span>: x100</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tuned</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">show_best</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No value of `metric` was given; metric 'roc_auc' will be used.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 10</span></span></span>
<span><span class="co">#&gt;    mtry trees min_n .metric .estimator  mean     n std_err .config .iter</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1  <span style="text-decoration: underline;">1</span>140     5 roc_auc binary     0.737     9  0.022<span style="text-decoration: underline;">9</span> Iter95     95</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1   905     4 roc_auc binary     0.737     9  0.023<span style="text-decoration: underline;">9</span> Iter53     53</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1  <span style="text-decoration: underline;">1</span>307     3 roc_auc binary     0.737     9  0.022<span style="text-decoration: underline;">4</span> Iter46     46</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1  <span style="text-decoration: underline;">1</span>927    10 roc_auc binary     0.736     9  0.023<span style="text-decoration: underline;">4</span> Iter26     26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     1  <span style="text-decoration: underline;">1</span>188     2 roc_auc binary     0.736     9  0.020<span style="text-decoration: underline;">4</span> Iter96     96</span></span></code></pre></div>
<p>After all that we haven’t much improved the ability of our model to
predict spatially separated testing data sets! This is not that
surprising since random forest generally doesn’t need much tuning. And
ultimately, the problem is not poor hyper-parameters but overfitting to
spatial patterns found in the data. This cannot be prevented except by
finding some way to help the model ‘account’ for spatial autocorrelation
in the data. There are some approaches to doing this, which might help,
but can only go so far. The problem of space is impossible to make go
away completely, at least using statistical methods.</p>
<p>Note that the best solutions had a very low <code>mtry</code>. This
means the random forest is only using 1 to 3 variables at a time to make
predictions. This implies all variable contain mostly the same amount of
information and don’t interact much, suggesting that these climate
predictors have little to do with the species distribution, each is
mainly being used for their spatial information. The best bet here, as
in most cases is to find better predictors that are more definitely
related to the species’ known ecology!</p>
<p>Lastly, <a href="https://rdinnager.github.io/tidysdm/">tidysdm</a> makes it easy to generate visualizable
predictions on the original landscape using the
<code><a href="../reference/create_prediction_grid.html">create_prediction_grid()</a></code> function, which creates a grid of
x and y values, optionally with a polygon attached to help with
plotting. Feeding this to the <code>augment</code> function will
automatically make predictions based on the model and the bind those
prediction back to the prediction grid data, ready for plotting. We will
make hexagons which look much cooler than squares (just use
<code>square = FALSE</code>).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_prediction_grid.html">create_prediction_grid</a></span><span class="op">(</span>bg <span class="op">=</span> <span class="va">monticola</span><span class="op">$</span><span class="va">range</span>, n <span class="op">=</span> <span class="fl">2500</span>, square <span class="op">=</span> <span class="cn">FALSE</span>, include_polygons <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_sample assumes that they are</span></span>
<span><span class="co">#&gt; planar</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred_grid</span><span class="op">$</span><span class="va">polygon</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_files/figure-html/preds-1.png" width="700"></p>
<p>Now to make the predictions we first do a final fit of our random
forest model on the full data set, and using the best hyper-parameters
from our spatial cross validation.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_fit</span> <span class="op">&lt;-</span> <span class="va">wf_tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">finalize_workflow</span><span class="op">(</span><span class="fu">select_best</span><span class="op">(</span><span class="va">tuned</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No value of `metric` was given; metric 'roc_auc' will be used.</span></span>
<span><span class="va">final_fit</span></span>
<span><span class="co">#&gt; ══ Workflow [trained] ══════════════════════════════════════════════════════════</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Model:</span> rand_forest()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; 4 Recipe Steps</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • step_add_env_vars()</span></span>
<span><span class="co">#&gt; • step_impute_median()</span></span>
<span><span class="co">#&gt; • step_YeoJohnson()</span></span>
<span><span class="co">#&gt; • step_normalize()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Ranger result</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt;  ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~1L,      x), num.trees = ~1140L, min.node.size = min_rows(~5L, x),      importance = ~"impurity", num.threads = 1, verbose = FALSE,      seed = sample.int(10^5, 1), probability = TRUE) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Type:                             Probability estimation </span></span>
<span><span class="co">#&gt; Number of trees:                  1140 </span></span>
<span><span class="co">#&gt; Sample size:                      5260 </span></span>
<span><span class="co">#&gt; Number of independent variables:  19 </span></span>
<span><span class="co">#&gt; Mtry:                             1 </span></span>
<span><span class="co">#&gt; Target node size:                 5 </span></span>
<span><span class="co">#&gt; Variable importance mode:         impurity </span></span>
<span><span class="co">#&gt; Splitrule:                        gini </span></span>
<span><span class="co">#&gt; OOB prediction error (Brier s.):  0.04441288</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Does not work yet</span></span>
<span><span class="va">pred_grid_preds</span> <span class="op">&lt;-</span> <span class="va">final_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">pred_grid</span><span class="op">)</span></span>
<span> </span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Russell Dinnage.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
